# 中控机系统架构分析

## 系统总体概述

中控机系统是一个复杂的风机监控网络，包含4个独立的网络接口，分别连接不同的设备和传感器。

## 网络架构详情

### 网卡1：风机控制专用网络
- **设备配置**：16口交换机
- **端口使用**：使用10个端口 这里是11个端口 因为10组驱动板 还有一个口得去连接网卡
- **连接结构**：
  - 每条链路由10个驱动板串接
  - 每个驱动板有2个网口（A口和B口）
  - 连接方式：每排第一个驱动板A口→交换机，B口→第二个驱动板A口
  - 第10个驱动板：A口连接第9个驱动板B口，B口悬空
- **设备总数**：100个电驱板控制1600个风机
- **控制特点**：串行链路，每条链路10个驱动板

### 网卡2：传感器专用网络
- **设备配置**：20口交换机
- **I/O模块**：16个远程I/O模块
- **传感器分布**：
  - 温度传感器：100个（使用12路模块，需要9个网口）（温度传感器使用RTC采集模块来采集，对应tem.py文件）
  - 风速传感器：100个（使用16路模块，需要7个网口）（使用模拟量采集模块采集）
  - 压力传感器：1个（是压力传感器有1个，但是压力传感器中带着温度信息，所以是一个模拟量采集温度，一个模拟量采集压力）
  - 湿度传感器：4个（有四个湿度传感器，每个有1个温度，一个湿度）
- **总传感器数量**：205个传感器
- **网络特点**：每个I/O模块占用一个交换机端口

### 网卡3：PLC控制专用网络
- **设备**：1个PLC控制器
- **通信协议**：OPC UA协议
- **用途**：逻辑控制和系统集成

### 电脑自带网卡：上位机通讯专用网络
- **设备**：1个上位机
- **通信协议**：TCP协议
- **用途**：与上层监控系统通信

## 现有代码分析

### 当前sensor.py代码特点
- **连接方式**：单点连接到192.168.0.101
- **支持的传感器**：仅支持温度和压力传感器
- **数据读取**：读取2个寄存器
- **通信协议**：Modbus RTU over TCP

### 代码与实际系统的不匹配之处

#### 1. 网络架构复杂度不足
- **现状**：单设备连接
- **实际需求**：需要同时管理16个I/O模块
- **缺口**：缺乏多连接并发处理能力

#### 2. 传感器类型支持不完整
- **现状**：仅支持温度、压力2种传感器
- **实际需求**：需要支持温度、风速、压力、湿度4种传感器
- **缺口**：缺少风速和湿度传感器支持

#### 3. 数据处理能力不足
- **现状**：处理2个寄存器数据
- **实际需求**：需要处理205个传感器的数据
- **缺口**：数据处理能力严重不足

#### 4. 网络端口管理缺失
- **现状**：单一IP和端口
- **实际需求**：需要管理20口交换机上的16个I/O模块
- **缺口**：缺乏多端口分配和管理机制

#### 5. 系统容错机制不完善
- **现状**：单设备连接的容错
- **实际需求**：需要处理16个I/O模块的各种连接异常
- **缺口**：缺乏大规模设备容错机制

## 技术挑战与难点

### 1. 并发连接管理
- 需要同时维护16个TCP连接
- 连接状态监控和自动重连
- 线程安全和资源管理

### 2. 数据同步与聚合
- 205个传感器的实时数据采集
- 不同类型传感器数据处理差异
- 数据时间戳同步

### 3. 网络负载均衡
- 16个I/O模块的网络负载分配
- 大量并发数据传输的优化
- 网络拥堵处理

### 4. 故障诊断与恢复
- 16个I/O模块的独立故障检测
- 部分模块失效时的系统降级运行
- 故障模块的自动恢复机制

## 建议的系统架构改进

### 1. 多线程架构设计
- 每个I/O模块独立线程处理
- 主线程负责数据聚合和管理
- 专门的监控线程处理异常

### 2. 模块化传感器支持
- 按传感器类型分类管理
- 支持不同类型的数据转换算法
- 灵活的传感器配置机制

### 3. 数据管理优化
- 实时数据缓存机制
- 历史数据存储策略
- 数据压缩和传输优化

### 4. 容错和自愈机制
- 连接状态实时监控
- 自动重连和故障转移
- 系统健康状态报告

## 性能要求

### 1. 实时性要求
- 205个传感器的快速轮询
- 数据采集延迟最小化
- 实时告警响应

### 2. 稳定性要求
- 16个I/O模块的长期稳定连接
- 7x24小时不间断运行
- 系统异常的快速恢复

### 3. 可扩展性要求
- 支持新增I/O模块
- 支持新类型传感器接入
- 系统参数的在线配置